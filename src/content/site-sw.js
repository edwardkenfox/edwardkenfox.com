!function(){"use strict";function e(e,t,r,n,a,i,s){try{var c=e[i](s),u=c.value}catch(e){return void r(e)}c.done?t(u):Promise.resolve(u).then(n,a)}function t(t){return function(){var r=this,n=arguments;return new Promise((function(a,i){var s=t.apply(r,n);function c(t){e(s,a,i,c,u,"next",t)}function u(t){e(s,a,i,c,u,"throw",t)}c(void 0)}))}}function r(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function n(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function a(e,t,r){return t&&n(e.prototype,t),r&&n(e,r),e}function i(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function s(){return(s=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])}return e}).apply(this,arguments)}function c(e,t){var r=Object.keys(e);return Object.getOwnPropertySymbols&&r.push.apply(r,Object.getOwnPropertySymbols(e)),t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r}function u(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?c(r,!0).forEach((function(t){i(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):c(r).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}function o(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){var r=[],n=!0,a=!1,i=void 0;try{for(var s,c=e[Symbol.iterator]();!(n=(s=c.next()).done)&&(r.push(s.value),!t||r.length!==t);n=!0);}catch(e){a=!0,i=e}finally{try{n||null==c.return||c.return()}finally{if(a)throw i}}return r}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance")}()}var h=function(e){var t=Object.prototype,r=t.hasOwnProperty,n="function"==typeof Symbol?Symbol:{},a=n.iterator||"@@iterator",i=n.asyncIterator||"@@asyncIterator",s=n.toStringTag||"@@toStringTag";function c(e,t,r,n){var a=t&&t.prototype instanceof h?t:h,i=Object.create(a.prototype),s=new w(n||[]);return i._invoke=function(e,t,r){var n="suspendedStart";return function(a,i){if("executing"===n)throw new Error("Generator is already running");if("completed"===n){if("throw"===a)throw i;return S()}for(r.method=a,r.arg=i;;){var s=r.delegate;if(s){var c=k(s,r);if(c){if(c===o)continue;return c}}if("next"===r.method)r.sent=r._sent=r.arg;else if("throw"===r.method){if("suspendedStart"===n)throw n="completed",r.arg;r.dispatchException(r.arg)}else"return"===r.method&&r.abrupt("return",r.arg);n="executing";var h=u(e,t,r);if("normal"===h.type){if(n=r.done?"completed":"suspendedYield",h.arg===o)continue;return{value:h.arg,done:r.done}}"throw"===h.type&&(n="completed",r.method="throw",r.arg=h.arg)}}}(e,r,s),i}function u(e,t,r){try{return{type:"normal",arg:e.call(t,r)}}catch(e){return{type:"throw",arg:e}}}e.wrap=c;var o={};function h(){}function p(){}function l(){}var f={};f[a]=function(){return this};var d=Object.getPrototypeOf,m=d&&d(d(R([])));m&&m!==t&&r.call(m,a)&&(f=m);var v=l.prototype=h.prototype=Object.create(f);function y(e){["next","throw","return"].forEach((function(t){e[t]=function(e){return this._invoke(t,e)}}))}function g(e){var t;this._invoke=function(n,a){function i(){return new Promise((function(t,i){!function t(n,a,i,s){var c=u(e[n],e,a);if("throw"!==c.type){var o=c.arg,h=o.value;return h&&"object"==typeof h&&r.call(h,"__await")?Promise.resolve(h.__await).then((function(e){t("next",e,i,s)}),(function(e){t("throw",e,i,s)})):Promise.resolve(h).then((function(e){o.value=e,i(o)}),(function(e){return t("throw",e,i,s)}))}s(c.arg)}(n,a,t,i)}))}return t=t?t.then(i,i):i()}}function k(e,t){var r=e.iterator[t.method];if(void 0===r){if(t.delegate=null,"throw"===t.method){if(e.iterator.return&&(t.method="return",t.arg=void 0,k(e,t),"throw"===t.method))return o;t.method="throw",t.arg=new TypeError("The iterator does not provide a 'throw' method")}return o}var n=u(r,e.iterator,t.arg);if("throw"===n.type)return t.method="throw",t.arg=n.arg,t.delegate=null,o;var a=n.arg;return a?a.done?(t[e.resultName]=a.value,t.next=e.nextLoc,"return"!==t.method&&(t.method="next",t.arg=void 0),t.delegate=null,o):a:(t.method="throw",t.arg=new TypeError("iterator result is not an object"),t.delegate=null,o)}function b(e){var t={tryLoc:e[0]};1 in e&&(t.catchLoc=e[1]),2 in e&&(t.finallyLoc=e[2],t.afterLoc=e[3]),this.tryEntries.push(t)}function x(e){var t=e.completion||{};t.type="normal",delete t.arg,e.completion=t}function w(e){this.tryEntries=[{tryLoc:"root"}],e.forEach(b,this),this.reset(!0)}function R(e){if(e){var t=e[a];if(t)return t.call(e);if("function"==typeof e.next)return e;if(!isNaN(e.length)){var n=-1,i=function t(){for(;++n<e.length;)if(r.call(e,n))return t.value=e[n],t.done=!1,t;return t.value=void 0,t.done=!0,t};return i.next=i}}return{next:S}}function S(){return{value:void 0,done:!0}}return p.prototype=v.constructor=l,l.constructor=p,l[s]=p.displayName="GeneratorFunction",e.isGeneratorFunction=function(e){var t="function"==typeof e&&e.constructor;return!!t&&(t===p||"GeneratorFunction"===(t.displayName||t.name))},e.mark=function(e){return Object.setPrototypeOf?Object.setPrototypeOf(e,l):(e.__proto__=l,s in e||(e[s]="GeneratorFunction")),e.prototype=Object.create(v),e},e.awrap=function(e){return{__await:e}},y(g.prototype),g.prototype[i]=function(){return this},e.AsyncIterator=g,e.async=function(t,r,n,a){var i=new g(c(t,r,n,a));return e.isGeneratorFunction(r)?i:i.next().then((function(e){return e.done?e.value:i.next()}))},y(v),v[s]="Generator",v[a]=function(){return this},v.toString=function(){return"[object Generator]"},e.keys=function(e){var t=[];for(var r in e)t.push(r);return t.reverse(),function r(){for(;t.length;){var n=t.pop();if(n in e)return r.value=n,r.done=!1,r}return r.done=!0,r}},e.values=R,w.prototype={constructor:w,reset:function(e){if(this.prev=0,this.next=0,this.sent=this._sent=void 0,this.done=!1,this.delegate=null,this.method="next",this.arg=void 0,this.tryEntries.forEach(x),!e)for(var t in this)"t"===t.charAt(0)&&r.call(this,t)&&!isNaN(+t.slice(1))&&(this[t]=void 0)},stop:function(){this.done=!0;var e=this.tryEntries[0].completion;if("throw"===e.type)throw e.arg;return this.rval},dispatchException:function(e){if(this.done)throw e;var t=this;function n(r,n){return s.type="throw",s.arg=e,t.next=r,n&&(t.method="next",t.arg=void 0),!!n}for(var a=this.tryEntries.length-1;a>=0;--a){var i=this.tryEntries[a],s=i.completion;if("root"===i.tryLoc)return n("end");if(i.tryLoc<=this.prev){var c=r.call(i,"catchLoc"),u=r.call(i,"finallyLoc");if(c&&u){if(this.prev<i.catchLoc)return n(i.catchLoc,!0);if(this.prev<i.finallyLoc)return n(i.finallyLoc)}else if(c){if(this.prev<i.catchLoc)return n(i.catchLoc,!0)}else{if(!u)throw new Error("try statement without catch or finally");if(this.prev<i.finallyLoc)return n(i.finallyLoc)}}}},abrupt:function(e,t){for(var n=this.tryEntries.length-1;n>=0;--n){var a=this.tryEntries[n];if(a.tryLoc<=this.prev&&r.call(a,"finallyLoc")&&this.prev<a.finallyLoc){var i=a;break}}i&&("break"===e||"continue"===e)&&i.tryLoc<=t&&t<=i.finallyLoc&&(i=null);var s=i?i.completion:{};return s.type=e,s.arg=t,i?(this.method="next",this.next=i.finallyLoc,o):this.complete(s)},complete:function(e,t){if("throw"===e.type)throw e.arg;return"break"===e.type||"continue"===e.type?this.next=e.arg:"return"===e.type?(this.rval=this.arg=e.arg,this.method="return",this.next="end"):"normal"===e.type&&t&&(this.next=t),o},finish:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var r=this.tryEntries[t];if(r.finallyLoc===e)return this.complete(r.completion,r.afterLoc),x(r),o}},catch:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var r=this.tryEntries[t];if(r.tryLoc===e){var n=r.completion;if("throw"===n.type){var a=n.arg;x(r)}return a}}throw new Error("illegal catch attempt")},delegateYield:function(e,t,r){return this.delegate={iterator:R(e),resultName:t,nextLoc:r},"next"===this.method&&(this.arg=void 0),o}},e}("object"==typeof module?module.exports:{});try{regeneratorRuntime=h}catch(e){Function("r","regeneratorRuntime = r")(h)}var p,l={js:36e5,css:36e5,document:864e5,image:864e5,font:864e5,unknown:36e5},f={cacheLimit:1e7,cacheConfig:l,viewportStayTimeThreshold:500,viewportRootMargin:"0px",pageWhitelist:["*"]},d="".concat(self.location.origin,"/precacher.repro.io/config"),m="".concat(d,"/gcindex"),v="".concat(d,"/expiration"),y="".concat(d,"/ts/latest"),g="".concat(d,"/ec/serialization"),k=new Response("",{status:200}),b=function(){function e(t){r(this,e),this.cache=t,this.cacheHitMap=Object.create(null)}var n,i,s,c;return a(e,[{key:"get",value:(c=t(regeneratorRuntime.mark((function e(t){var r;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!this.cacheHitMap[t]){e.next=2;break}return e.abrupt("return",this.cacheHitMap[t].clone());case 2:return e.next=4,this.cache;case 4:return e.t0=t,e.next=7,e.sent.match(e.t0);case 7:return(r=e.sent)&&(this.cacheHitMap[t]=r.clone()),e.abrupt("return",r?r.clone():r);case 10:case"end":return e.stop()}}),e,this)}))),function(e){return c.apply(this,arguments)})},{key:"put",value:(s=t(regeneratorRuntime.mark((function e(t,r){return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return this.cacheHitMap[t]=r,e.next=3,this.cache;case 3:return e.t0=t,e.t1=r.clone(),e.next=7,e.sent.put(e.t0,e.t1);case 7:case"end":return e.stop()}}),e,this)}))),function(e,t){return s.apply(this,arguments)})},{key:"delete",value:(i=t(regeneratorRuntime.mark((function e(t){return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return delete this.cacheHitMap[t],e.next=3,this.cache;case 3:return e.t0=t,e.next=6,e.sent.delete(e.t0);case 6:case"end":return e.stop()}}),e,this)}))),function(e){return i.apply(this,arguments)})},{key:"keys",value:(n=t(regeneratorRuntime.mark((function e(){return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",this.cache.then((function(e){return e.keys()})));case 1:case"end":return e.stop()}}),e,this)}))),function(){return n.apply(this,arguments)})}]),e}(),x=new b(caches.open("".concat("rpr-precacher","-config"))),w=new b(caches.open("".concat("rpr-precacher","-too-large-entries"))),R=new b(caches.open("".concat("rpr-precacher","-m"))),S=function(){return x.get(d).then((function(e){return e?e.clone().json():f}))},M=function(e,t){return new b(caches.open("".concat("rpr-precacher","-").concat(e,"-entity-").concat(t)))},z=function(){var e=t(regeneratorRuntime.mark((function e(t,r){var n,a,i,s,c;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=t.clone(),a=n.blob(),e.next=4,a;case 4:return i=e.sent,s=function(){var e=new Headers,r=t.headers.entries(),n=!0,a=!1,s=void 0;try{for(var c,u=r[Symbol.iterator]();!(n=(c=u.next()).done);n=!0){var o=c.value;e.append(o[0],o[1])}}catch(e){a=!0,s=e}finally{try{n||null==u.return||u.return()}finally{if(a)throw s}}return e.get("content-length")||e.set("content-length","".concat(i.size)),e}(),c=r?r(s):s,e.abrupt("return",new Response(i,{headers:c,status:n.status,statusText:n.statusText}));case 9:case"end":return e.stop()}}),e)})));return function(t,r){return e.apply(this,arguments)}}(),C=function(){function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:function(e,t){return e.priority-t.priority};r(this,e),this.comparator=t,this.tree=[]}return a(e,[{key:"push",value:function(e){var t=e.value,r=e.priority;this.tree.push({value:t,priority:r}),1!==this.tree.length&&function(e,t){for(var r=e.length-1,n=r,a=e[r];r>=0;){if(!((e[r=r-1>>1]?t(e[r],a):0)<0))break;var i=e[r];e[r]=a,e[n]=i,n=r}}(this.tree,this.comparator)}},{key:"pop",value:function(){var e=this.tree[0],t=this.tree.pop();return t&&(this.tree[0]=t,function(e,t){for(var r=0,n=r,a=e[r];r<e.length;){var i=1+(r<<1),s=2+(r<<1),c=i,u=e[i]?t(e[i],a):0,o=e[s]?t(e[s],a):0;if(u>0)c=i;else{if(!(o>0))break;c=s}var h=e[c];e[c]=a,e[n]=h,n=r,r=c}}(this.tree,this.comparator)),e?e.value:void 0}},{key:"peek",value:function(){return this.tree[0]?this.tree[0].value:void 0}},{key:"length",get:function(){return this.tree.length}}]),e}(),E=function(){function e(){r(this,e),this.length=0,this.st1=[],this.st2=[]}return a(e,[{key:Symbol.iterator,value:regeneratorRuntime.mark((function e(){var t,r,n,a,i,s,c;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:t=this.st2.length-1;case 1:if(!(t>=0)){e.next=7;break}return e.next=4,this.st2[t];case 4:t--,e.next=1;break;case 7:r=!0,n=!1,a=void 0,e.prev=10,i=this.st1[Symbol.iterator]();case 12:if(r=(s=i.next()).done){e.next=19;break}return c=s.value,e.next=16,c;case 16:r=!0,e.next=12;break;case 19:e.next=25;break;case 21:e.prev=21,e.t0=e.catch(10),n=!0,a=e.t0;case 25:e.prev=25,e.prev=26,r||null==i.return||i.return();case 28:if(e.prev=28,!n){e.next=31;break}throw a;case 31:return e.finish(28);case 32:return e.finish(25);case 33:case"end":return e.stop()}}),e,this,[[10,21,25,33],[26,,28,32]])}))},{key:"entries",value:function(){var e,t=this,r=1,n=0,a=0;return i(e={},Symbol.iterator,(function(){return this})),i(e,"next",(function(){return t.st2.length>=r?{value:[a++,t.st2[t.st2.length-r++]],done:!1}:t.st2.length<=r&&!t.st1.length?{value:void 0,done:!0}:t.st1.length>n?{value:[a++,t.st1[n++]],done:!1}:{value:void 0,done:!0}})),e}},{key:"peek",value:function(){return this.st2.length?this.st2[this.st2.length-1]:this.st1[0]}},{key:"pop",value:function(){if(this.length>0&&this.length--,this.st2.length)return this.st2.pop();for(;this.st1.length;)this.st2.push(this.st1.pop());return this.st2.pop()}},{key:"push",value:function(e){this.st1.push(e),this.length++}},{key:"toArray",value:function(){for(var e=[],t=this.st2.length-1;t>=0;t--)e.push(this.st2[t]);return e.concat(this.st1)}}]),e}(),L=function(){var e=!1,r=new E,n=function(){var a=t(regeneratorRuntime.mark((function a(i){var s;return regeneratorRuntime.wrap((function(a){for(;;)switch(a.prev=a.next){case 0:if(!e){a.next=2;break}return a.abrupt("return",new Promise((function(e){r.push(t(regeneratorRuntime.mark((function t(){return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.t0=e,t.next=3,i();case 3:t.t1=t.sent,(0,t.t0)(t.t1);case 5:case"end":return t.stop()}}),t)}))))})));case 2:return e=!0,a.next=5,i();case 5:return s=a.sent,setTimeout((function(){e=!1,r.length&&n(r.pop())}),10),a.abrupt("return",s);case 8:case"end":return a.stop()}}),a)})));return function(e){return a.apply(this,arguments)}}();return n},P={js:1,css:2,document:3,image:4,font:5,unknown:6},H=["unknown","js","css","document","image","font","unknown"],I=function e(t){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,a=arguments.length>2?arguments[2]:void 0;r(this,e),this.key=t,this.sizeHint=n,this.data=a,this.next="",this.prev=""};!function(e){e[e.LENGTH=1]="LENGTH",e[e.SIZE=2]="SIZE"}(p||(p={}));var O,_,j=function(){function e(){r(this,e),this.entryMap={}}var n,i,s,c,u;return a(e,[{key:"restore",value:(u=t(regeneratorRuntime.mark((function e(t){return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:case"end":return e.stop()}}),e)}))),function(e){return u.apply(this,arguments)})},{key:"onUpdate",value:(c=t(regeneratorRuntime.mark((function e(t){return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:case"end":return e.stop()}}),e)}))),function(e){return c.apply(this,arguments)})},{key:"get",value:(s=t(regeneratorRuntime.mark((function e(t){return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",this.entryMap[t]);case 1:case"end":return e.stop()}}),e,this)}))),function(e){return s.apply(this,arguments)})},{key:"set",value:(i=t(regeneratorRuntime.mark((function e(t,r){return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:this.entryMap[t]=r;case 1:case"end":return e.stop()}}),e,this)}))),function(e,t){return i.apply(this,arguments)})},{key:"delete",value:(n=t(regeneratorRuntime.mark((function e(t){return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:delete this.entryMap[t];case 1:case"end":return e.stop()}}),e,this)}))),function(e){return n.apply(this,arguments)})}]),e}(),N=function(){var e=t(regeneratorRuntime.mark((function e(t,r,n,a){var i,s,c,u;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(i=t.next,s=t.prev,i&&(c=r[i])&&(c.prev=s),s&&(u=r[s])&&(u.next=i),delete r[t.key],!a){e.next=6;break}return e.abrupt("return",n.delete(t.key));case 6:case"end":return e.stop()}}),e)})));return function(t,r,n,a){return e.apply(this,arguments)}}(),A=function(){function e(t){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:new j,a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"";r(this,e),this.limit=t,this.cacheStorageHost=n,this.name=a,this.length=0,this.size=0,this.cacheMetadata=Object.create(null),this.deleteHandlers=[],this.asyncQueue=L(),this.restorePromise=this.cacheStorageHost.restore(this)}var n,i,c,u,o,h,l,f,d,m,v,y,g,k;return a(e,[{key:"updateLimit",value:(k=t(regeneratorRuntime.mark((function e(t){return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return this.limit=t,e.next=3,this.cacheStorageHost.onUpdate(this);case 3:case"end":return e.stop()}}),e,this)}))),function(e){return k.apply(this,arguments)})},{key:"getLimit",value:function(){return this.limit}},{key:"put",value:(g=t(regeneratorRuntime.mark((function e(r){var n,a,i,s,c,u=this,o=arguments;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=r.key,a=r.value,i=r.sizeHint,s=r.data,c=o.length>1&&void 0!==o[1]&&o[1],e.abrupt("return",this.asyncQueue(t(regeneratorRuntime.mark((function e(){var t,r,o;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,u.restorePromise;case 2:return e.next=4,u.recoveryLruIntegrityIfNecessary();case 4:if(u.lru){e.next=15;break}if(u.lru=new I(n,i,s),u.mru=u.lru,u.cacheMetadata[n]=u.lru,u.length=1,u.size=u.mru.sizeHint,null==a){e.next=13;break}return e.next=13,u.cacheStorageHost.set(n,a);case 13:e.next=32;break;case 15:if(!u.mru){e.next=32;break}if(!(t=u.cacheMetadata[n])){e.next=22;break}return e.next=20,u.touch(t);case 20:e.next=32;break;case 22:if(r=new I(n,i,s),u.mru.next=r.key,r.prev=u.mru.key,u.cacheMetadata[r.key]=r,u.mru=r,u.length++,u.size+=r.sizeHint,null==a){e.next=32;break}return e.next=32,u.cacheStorageHost.set(n,a);case 32:return o=[],e.next=35,u.shrink({shouldIgnoreEvent:c,popedEntryList:o});case 35:return e.next=37,u.updateSerializedData();case 37:return e.abrupt("return",o);case 38:case"end":return e.stop()}}),e)})))));case 3:case"end":return e.stop()}}),e,this)}))),function(e){return g.apply(this,arguments)})},{key:"delete",value:(y=t(regeneratorRuntime.mark((function e(r){var n,a,i,s,c,u=this,o=arguments;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=o.length>1&&void 0!==o[1]?o[1]:{},a=n.shouldIgnoreEvent,i=void 0!==a&&a,s=n.shouldDeleteFromHost,c=void 0===s||s,e.abrupt("return",this.asyncQueue(t(regeneratorRuntime.mark((function e(){var t,n;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,u.restorePromise;case 2:if(u.length){e.next=4;break}return e.abrupt("return",!1);case 4:return e.next=6,u.recoveryLruIntegrityIfNecessary();case 6:if(t=u.cacheMetadata[r],!(u.lru&&u.mru&&t)){e.next=24;break}if(n=c,i){e.next=15;break}return e.next=12,Promise.all(u.deleteHandlers.map((function(e){return e(t)})));case 12:if(e.t0=function(e){return!1===e},!e.sent.some(e.t0)){e.next=15;break}n=!1;case 15:return u.lru.key===t.key?u.lru=u.cacheMetadata[t.next]:u.mru.key===t.key&&(u.mru=u.cacheMetadata[t.prev]),u.length--,u.size-=t.sizeHint,1===u.length?u.mru=u.lru:0===u.length&&(u.mru=void 0,u.lru=void 0,u.size=0),e.next=21,N(t,u.cacheMetadata,u.cacheStorageHost,n);case 21:return e.next=23,u.updateSerializedData();case 23:return e.abrupt("return",!0);case 24:return e.abrupt("return",!1);case 25:case"end":return e.stop()}}),e)})))));case 2:case"end":return e.stop()}}),e,this)}))),function(e){return y.apply(this,arguments)})},{key:"pop",value:(v=t(regeneratorRuntime.mark((function e(){var r,n,a,i,s,c=this,u=arguments;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=u.length>0&&void 0!==u[0]?u[0]:{},n=r.shouldIgnoreEvent,a=void 0!==n&&n,i=r.shouldDeleteFromHost,s=void 0===i||i,e.abrupt("return",this.asyncQueue(t(regeneratorRuntime.mark((function e(){return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,c.restorePromise;case 2:return e.abrupt("return",c.popLruEntry({shouldIgnoreEvent:a,shouldDeleteFromHost:s}));case 3:case"end":return e.stop()}}),e)})))));case 2:case"end":return e.stop()}}),e,this)}))),function(){return v.apply(this,arguments)})},{key:"estimate",value:function(e){if(this.limit.type===p.SIZE&&this.limit.value<e)return{entries:[],isAcceptable:!1};var t=this.size,r=this.length;this.size+=e,this.length++;for(var n=[],a=this.lru;a&&this.isSizeExceeded();)this.size-=a.sizeHint,this.length--,n.push(a),a=this.cacheMetadata[a.next];return this.size=t,this.length=r,{entries:n,isAcceptable:!0}}},{key:"get",value:(m=t(regeneratorRuntime.mark((function e(t){return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",this.getEntry(t).then((function(e){return e?e.value:void 0})));case 1:case"end":return e.stop()}}),e,this)}))),function(e){return m.apply(this,arguments)})},{key:"getEntry",value:(d=t(regeneratorRuntime.mark((function e(r){var n,a,i,s=this,c=arguments;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=c.length>1&&void 0!==c[1]?c[1]:{},a=n.isMetadataOnly,i=void 0!==a&&a,e.abrupt("return",this.asyncQueue(t(regeneratorRuntime.mark((function e(){var t,n;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,s.restorePromise;case 2:if(!i){e.next=5;break}return t=s.cacheMetadata[r],e.abrupt("return",t?{entry:t,value:void 0}:void 0);case 5:return e.next=7,s.verifyCache({key:r,mustReturnValidEntry:!1});case 7:if(!(n=e.sent)){e.next=15;break}if(!n.entry){e.next=12;break}return e.next=12,s.touch(n.entry);case 12:if(n.value){e.next=14;break}return e.abrupt("return",void 0);case 14:return e.abrupt("return",{entry:n.entry,value:n.value});case 15:return e.abrupt("return",void 0);case 16:case"end":return e.stop()}}),e)})))));case 2:case"end":return e.stop()}}),e,this)}))),function(e){return d.apply(this,arguments)})},{key:"keys",value:(f=t(regeneratorRuntime.mark((function e(){var r=this;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",this.asyncQueue(t(regeneratorRuntime.mark((function e(){return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,r.restorePromise;case 2:return e.abrupt("return",Object.keys(r.cacheMetadata));case 3:case"end":return e.stop()}}),e)})))));case 1:case"end":return e.stop()}}),e,this)}))),function(){return f.apply(this,arguments)})},{key:"lookupMetadata",value:function(e){return this.cacheMetadata[e]}},{key:"lookupCache",value:(l=t(regeneratorRuntime.mark((function e(t){var r;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.verifyCache({key:t,mustReturnValidEntry:!1});case 2:if(!(r=e.sent)){e.next=5;break}return e.abrupt("return",r.value);case 5:case"end":return e.stop()}}),e,this)}))),function(e){return l.apply(this,arguments)})},{key:"addOnDeleteHandler",value:function(e){this.deleteHandlers.push(e)}},{key:"restore",value:function(e){s(this,e)}},{key:"toJSON",value:function(){return{size:this.size,length:this.length,limit:this.limit,cacheMetadata:this.cacheMetadata,mru:this.mru?this.mru:void 0,lru:this.lru?this.lru:void 0,name:this.name}}},{key:"popLruEntry",value:(h=t(regeneratorRuntime.mark((function e(){var t,r,n,a,i,s,c,u,o,h,p,l=arguments;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t=l.length>0&&void 0!==l[0]?l[0]:{},r=t.shouldIgnoreEvent,n=void 0!==r&&r,a=t.shouldDeleteFromHost,i=void 0===a||a,this.length){e.next=3;break}return e.abrupt("return");case 3:return e.next=5,this.recoveryLruIntegrityIfNecessary();case 5:if(this.lru&&this.mru){e.next=7;break}return e.abrupt("return");case 7:if(this.length--,this.size-=this.lru.sizeHint,s=this.lru,c=this.lru,u=c.next,o=c.key,(h=this.cacheMetadata[u])&&(this.lru=h,this.lru.prev=""),delete this.cacheMetadata[s.key],1===this.length?(this.mru=this.lru,this.mru.next="",this.mru.prev=""):this.length||(this.size=0,this.lru=void 0,this.mru=void 0),p=i,n){e.next=22;break}return e.next=19,Promise.all(this.deleteHandlers.map((function(e){return e(s)})));case 19:if(e.t0=function(e){return!1===e},!e.sent.some(e.t0)){e.next=22;break}p=!1;case 22:if(!p){e.next=25;break}return e.next=25,this.cacheStorageHost.delete(o);case 25:return e.next=27,this.updateSerializedData();case 27:return"probation"===this.name&&console.log("evicted",s.key,this.name),e.abrupt("return",s);case 29:case"end":return e.stop()}}),e,this)}))),function(){return h.apply(this,arguments)})},{key:"touch",value:(o=t(regeneratorRuntime.mark((function e(t){var r;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!this.mru||this.mru.key!==t.key){e.next=2;break}return e.abrupt("return");case 2:if(this.mru){e.next=5;break}return this.mru=t,e.abrupt("return");case 5:if(this.lru){e.next=8;break}return this.lru=t,e.abrupt("return");case 8:return r=t.next,N(t,this.cacheMetadata,this.cacheStorageHost,!1),t.key===this.lru.key&&r&&(this.lru=this.cacheMetadata[r]),this.mru.next=t.key,t.next="",t.prev=this.mru.key,this.mru=t,this.cacheMetadata[t.key]=t,e.next=18,this.updateSerializedData();case 18:case"end":return e.stop()}}),e,this)}))),function(e){return o.apply(this,arguments)})},{key:"shrink",value:(u=t(regeneratorRuntime.mark((function e(){var t,r,n,a,i,s=arguments;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t=s.length>0&&void 0!==s[0]?s[0]:{},r=t.shouldIgnoreEvent,n=void 0===r||r,a=t.popedEntryList,!this.isSizeExceeded()){e.next=7;break}return e.next=4,this.popLruEntry({shouldIgnoreEvent:n});case 4:return(i=e.sent)&&a&&a.push(i),e.abrupt("return",this.shrink({shouldIgnoreEvent:n}));case 7:case"end":return e.stop()}}),e,this)}))),function(){return u.apply(this,arguments)})},{key:"verifyCache",value:(c=t(regeneratorRuntime.mark((function e(t){var r,n,a,i,s;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(r=t.key,n=t.mustReturnValidEntry,!(a=this.cacheMetadata[r])){e.next=19;break}return e.next=5,this.cacheStorageHost.get(r);case 5:if(i=e.sent){e.next=18;break}return this.lru&&this.lru.key===a.key&&(this.lru=this.cacheMetadata[a.next]),this.mru&&this.mru.key===a.key&&(this.mru=this.cacheMetadata[a.prev]),e.next=11,N(a,this.cacheMetadata,this.cacheStorageHost,!1);case 11:return this.size-=a.sizeHint,this.length--,0===this.length&&this.reset(),e.next=16,this.verifyCache({key:a.next,mustReturnValidEntry:n});case 16:return s=e.sent,e.abrupt("return",n?s:void 0);case 18:return e.abrupt("return",{value:i,entry:a});case 19:return e.next=21,this.cacheStorageHost.delete(r);case 21:return e.abrupt("return",void 0);case 22:case"end":return e.stop()}}),e,this)}))),function(e){return c.apply(this,arguments)})},{key:"verifyIntegrity",value:function(){var e={},t=0,r=0;if(this.lru){var n=this.lru;for(t=n.sizeHint,r=1;n!==this.mru;){if(e[n.key])return!1;if(e[n.key]=!0,!n.next)break;var a=this.cacheMetadata[n.next];if(!a)return!1;t+=(n=a).sizeHint,r++}}return this.length?!!this.lru&&!!this.mru&&t===this.size&&r===this.length:(this.reset(),!0)}},{key:"reset",value:function(){s(this,{lru:void 0,mru:void 0,cacheMetadata:Object.create(null),size:0,length:0})}},{key:"isSizeExceeded",value:function(){return(this.limit.type===p.LENGTH?this.length:this.size)>this.limit.value}},{key:"updateSerializedData",value:(i=t(regeneratorRuntime.mark((function e(){return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!this.verifyIntegrity()){e.next=3;break}return e.next=3,this.cacheStorageHost.onUpdate(this);case 3:case"end":return e.stop()}}),e,this)}))),function(){return i.apply(this,arguments)})},{key:"recoveryLruIntegrityIfNecessary",value:(n=t(regeneratorRuntime.mark((function e(){return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!this.length||this.lru&&this.mru){e.next=4;break}return e.next=3,this.cacheStorageHost.restore(this);case 3:this.lru&&this.mru&&this.verifyIntegrity()||this.reset();case 4:case"end":return e.stop()}}),e,this)}))),function(){return n.apply(this,arguments)})}]),e}(),D=function(){function e(t,n){var a=t.type,i=t.value;r(this,e),this.asyncQueue=L(),this.probationSegment=new A({type:a,value:.7*i},n,"probation"),this.protectedSegment=new A({type:a,value:.3*i},n,"protected")}var n,i,s;return a(e,[{key:"put",value:(s=t(regeneratorRuntime.mark((function e(r){var n,a,i,s,c=this;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=r.key,a=r.value,i=r.sizeHint,s=r.data,e.abrupt("return",this.asyncQueue(t(regeneratorRuntime.mark((function e(){return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(c.protectedSegment.lookupMetadata(n)||c.probationSegment.lookupMetadata(n)){e.next=3;break}return e.next=3,c.probationSegment.put({key:n,value:a,sizeHint:i,data:s});case 3:case"end":return e.stop()}}),e)})))));case 2:case"end":return e.stop()}}),e,this)}))),function(e){return s.apply(this,arguments)})},{key:"get",value:(i=t(regeneratorRuntime.mark((function e(r){var n=this;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",this.asyncQueue(t(regeneratorRuntime.mark((function e(){var t,a;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!(t=n.probationSegment.lookupMetadata(r))){e.next=11;break}return e.next=4,n.probationSegment.get(r);case 4:if(!(a=e.sent)){e.next=10;break}return e.next=8,n.probationSegment.delete(r,{shouldDeleteFromHost:!1});case 8:return e.next=10,n.protectedSegment.put(t);case 10:return e.abrupt("return",a);case 11:return e.abrupt("return",n.protectedSegment.get(r));case 12:case"end":return e.stop()}}),e)})))));case 1:case"end":return e.stop()}}),e,this)}))),function(e){return i.apply(this,arguments)})},{key:"delete",value:(n=t(regeneratorRuntime.mark((function e(r){var n=this;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",this.asyncQueue(t(regeneratorRuntime.mark((function e(){return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,n.probationSegment.delete(r);case 2:if(e.sent){e.next=5;break}return e.next=5,n.protectedSegment.delete(r);case 5:case"end":return e.stop()}}),e)})))));case 1:case"end":return e.stop()}}),e,this)}))),function(e){return n.apply(this,arguments)})},{key:"estimate",value:function(e,t){if(this.protectedSegment.lookupMetadata(e))return{isAcceptable:!0,entries:[]};var r=this.probationSegment.lookupMetadata(e);return r?this.protectedSegment.estimate(r.sizeHint):this.probationSegment.estimate(t)}},{key:"lookupMetadata",value:function(e){return this.lookupProbationMetadata(e)||this.lookupProtectedMetadata(e)}},{key:"lookupProbationMetadata",value:function(e){return this.probationSegment.lookupMetadata(e)}},{key:"lookupProtectedMetadata",value:function(e){return this.protectedSegment.lookupMetadata(e)}},{key:"toJSON",value:function(){return{probationSegment:this.probationSegment.toJSON(),protectedSegment:this.protectedSegment.toJSON()}}},{key:"size",get:function(){return this.probationSegment.size+this.protectedSegment.size}}]),e}(),T=[3432918353,461845907,3276165377,4246287263],U=function(e){for(var t=T[0],r=0;r<e.length;r++)t*=T[1],t^=e.charCodeAt(r);return 0|t},G=function(e,t,r){var n=(e+T[t])%10000000007*T[t]%10000000007;return(n+=n>>>16)&r},q=function(e){return 1<<-Math.clz32(e-1)},Q=function(){function e(t){r(this,e),this.specifiedCapacity=t,this.tableMask=0,this.size=0,this.capacity=0,this.cachedHash=Object.create(null),this.capacity=Math.min(this.specifiedCapacity,2147483647)>>3,this.table=new Uint8Array(0===this.capacity?1:q(this.capacity)),this.tableMask=Math.max(1,this.table.length-1)}return a(e,[{key:"byteLength",value:function(){return this.table.byteLength}},{key:"mightContains",value:function(e){var t=this.cachedHash[e]||U(e);this.cachedHash[e]=t;var r=1+(1+(7&t)>>>1),n=G(t,0,this.tableMask);if(0==(this.table[n]&r))return!1;var a=G(t,1,this.tableMask);if(0==(this.table[a]&r<<1))return!1;var i=G(t,2,this.tableMask);if(0==(this.table[i]&r<<2))return!1;var s=G(t,3,this.tableMask);return 0!=(this.table[s]&r<<3)}},{key:"put",value:function(e){var t=this.cachedHash[e]||U(e);this.cachedHash[e]=t;var r=1+(1+(7&t)>>>1),n=G(t,0,this.tableMask),a=G(t,1,this.tableMask),i=G(t,2,this.tableMask),s=G(t,3,this.tableMask),c=this.putAt(n,r);return c|=this.putAt(a,r<<1),c|=this.putAt(i,r<<2),c|=this.putAt(s,r<<3),this.size+=c,!!c}},{key:"clearAllBits",value:function(){s(this,new e(this.specifiedCapacity))}},{key:"serialize",value:function(){return{table:this.table,metadata:[this.tableMask,this.size,this.capacity,this.specifiedCapacity]}}},{key:"restore",value:function(e){var t=o(e.metadata,4),r=t[0],n=t[1],a=t[2],i=t[3];this.table=e.table,this.tableMask=r,this.size=n,this.capacity=a,this.specifiedCapacity=i}},{key:"probabilities",value:function(){var e=8*this.tableMask,t=this.size;return 1-Math.pow(1-Math.exp(-4*t/e),4)}},{key:"putAt",value:function(e,t){return this.table[e]&t?0:(this.table[e]|=t,1)}}]),e}(),F=function(){function e(t){var n=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];r(this,e),this.specifiedCapacity=t,this.willResetIfReachingSampleSize=n,this.tableMask=0,this.sampleSize=0,this.size=0,this.capacity=0,this.cachedHash=Object.create(null),this.capacity=Math.min(t,2147483647)<<1,this.table=new Uint32Array(0===this.capacity?1:q(this.capacity)),this.sampleSize=0===t?10:10*this.capacity,this.sampleSize<=0&&(this.sampleSize=Number.MAX_SAFE_INTEGER),this.tableMask=Math.max(1,this.table.length-1)}return a(e,[{key:"byteLength",value:function(){return this.table.byteLength}},{key:"mightCount",value:function(e){var t=this.cachedHash[e]||U(e);this.cachedHash[e]=t;for(var r=1+(7&t)>>>1,n=Number.MAX_SAFE_INTEGER,a=0;a<4;a++){var i=G(t,a,this.tableMask),s=this.table[i]>>>(r+a<<2)&15;n=Math.min(n,s)}return n!==Number.MAX_SAFE_INTEGER?n:0}},{key:"increment",value:function(e){var t=this.cachedHash[e]||U(e);this.cachedHash[e]=t;var r=1+(7&t)>>>1,n=G(t,0,this.tableMask),a=G(t,1,this.tableMask),i=G(t,2,this.tableMask),s=G(t,3,this.tableMask),c=this.incrementAt(n,r);c|=this.incrementAt(a,r+1),c|=this.incrementAt(i,r+2),c|=this.incrementAt(s,r+3),this.size+=c,this.willResetIfReachingSampleSize&&c&&this.size===this.sampleSize&&this.reset()}},{key:"serialize",value:function(){return{table:this.table,metadata:[this.tableMask,this.sampleSize,this.size,this.capacity,this.specifiedCapacity,+this.willResetIfReachingSampleSize]}}},{key:"restore",value:function(e){var t=o(e.metadata,6),r=t[0],n=t[1],a=t[2],i=t[3],s=t[4],c=t[5];this.table=e.table,this.tableMask=r,this.sampleSize=n,this.size=a,this.capacity=i,this.specifiedCapacity=s,this.willResetIfReachingSampleSize=!!c}},{key:"clearAllBits",value:function(){s(this,new e(this.specifiedCapacity,this.willResetIfReachingSampleSize))}},{key:"probabilities",value:function(){var e=8*this.tableMask,t=this.size;return 1-Math.pow(1-Math.exp(-4*t/e),4)}},{key:"incrementAt",value:function(e,t){var r=t<<2,n=15<<r;return(this.table[e]&n)!==n?(this.table[e]+=1<<r,1):0}},{key:"reset",value:function(){for(var e,t,r=0,n=0;n<this.table.length;n++)r+=(e=286331153&this.table[n],t=void 0,((t=e-(e>>1&3681400539)-(e>>2&1227133513))+(t>>3)&3340530119)%63),this.table[n]=this.table[n]>>>1&2004318071;this.size=(this.size>>>1)-(r>>>2)}}]),e}(),B=function(){function e(t){r(this,e),this.doorkeeper=new Q(t),this.frequencySketch=new F(t<<2)}return a(e,[{key:"judge",value:function(e,t){var r=this;if(!t.length)return!0;var n=Math.ceil(t.reduce((function(e,t){return e+r.frequency(t)}),0)/(t.length||1));return this.frequency(e)>=n}},{key:"frequency",value:function(e){return this.doorkeeper.mightContains(e.key)?this.frequencySketch.mightCount(e.key)||1:0}},{key:"put",value:function(e){this.doorkeeper.mightContains(e)?this.frequencySketch.increment(e):this.doorkeeper.put(e)}},{key:"restoreDoorkeeper",value:function(e){this.doorkeeper.restore(e)}},{key:"restoreFrequencySketch",value:function(e){this.frequencySketch.restore(e)}},{key:"keepEfficiency",value:function(){return this.doorkeeper.probabilities()<.65&&(this.doorkeeper.clearAllBits(),!0)}},{key:"serialize",value:function(){return{dk:this.doorkeeper.serialize(),fs:this.frequencySketch.serialize()}}},{key:"size",value:function(){return this.doorkeeper.byteLength()+this.frequencySketch.byteLength()}}]),e}(),J=function(){function e(t,n,a){r(this,e),this.fastCache=t,this.cacheSerializer=n,this.onRequestSerialization=a}var n,i,s,c,u;return a(e,[{key:"restore",value:(u=t(regeneratorRuntime.mark((function e(t){return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r="Restored",n=void 0,n=new Date,fetch("https://jsonplaceholder.typicode.com/posts",{method:"post",body:JSON.stringify({log:"".concat(n.getFullYear(),"-").concat(String(n.getMonth()+1).padStart(2,"0"),"-").concat(String(n.getDate()).padStart(2,"0")," ").concat(String(n.getHours()).padStart(2,"0"),":").concat(String(n.getMinutes()).padStart(2,"0"),":").concat(String(n.getMilliseconds()).padStart(2,"0")," ").concat(r)}),headers:{"content-type":"application/json"}}).catch((function(e){})),e.abrupt("return",this.cacheSerializer.restoreLruCache({lruCache:t,isMainCache:"window"!==t.name}));case 2:case"end":return e.stop()}var r,n}),e,this)}))),function(e){return u.apply(this,arguments)})},{key:"get",value:(c=t(regeneratorRuntime.mark((function e(t){var r,n,a,i,s,c,u;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.fastCache.get(t);case 2:if(!(r=e.sent)){e.next=25;break}if(n=r.headers.get("x-repro-cache-timestamp"),(a=r.headers.get("x-repro-cache-type"))&&n){e.next=8;break}return e.abrupt("return",void 0);case 8:return i=parseInt(n,10),s=r.clone(),e.next=12,x.get(v);case 12:if(!(c=e.sent)){e.next=19;break}return e.next=16,c.json();case 16:e.t0=e.sent,e.next=20;break;case 19:e.t0=l;case 20:if((u=e.t0)[a]){e.next=23;break}return e.abrupt("return",void 0);case 23:if(!(Date.now()-i<=u[a])){e.next=25;break}return e.abrupt("return",s);case 25:return e.abrupt("return",void 0);case 26:case"end":return e.stop()}}),e,this)}))),function(e){return c.apply(this,arguments)})},{key:"set",value:(s=t(regeneratorRuntime.mark((function e(t,r){return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",this.fastCache.put(t,r.clone()));case 1:case"end":return e.stop()}}),e,this)}))),function(e,t){return s.apply(this,arguments)})},{key:"delete",value:(i=t(regeneratorRuntime.mark((function e(t){return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.fastCache.delete(t);case 2:case"end":return e.stop()}}),e,this)}))),function(e){return i.apply(this,arguments)})},{key:"onUpdate",value:(n=t(regeneratorRuntime.mark((function e(t){return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:this.onRequestSerialization(t);case 1:case"end":return e.stop()}}),e,this)}))),function(e){return n.apply(this,arguments)})}]),e}(),Z=!1,W=function(){function e(t,n,a){var i=this;r(this,e),this.limit=t,this.index=n,this.cacheSerializer=a,this.asyncQueue=L(),this.admissionPolicy=new B(1e4);var s=t-this.admissionPolicy.size();this.windowCacheEntityStorage=M("w",this.index),this.mainCacheEntityStorage=M("m",this.index),this.windowCache=new A({type:p.SIZE,value:.1*s|0},new J(this.windowCacheEntityStorage,this.cacheSerializer,(function(e){i.latestWindowCache=e})),"window"),this.mainCache=new D({type:p.SIZE,value:.9*s|0},new J(this.mainCacheEntityStorage,this.cacheSerializer,(function(e){"probation"===e.name?i.latestMainCacheProbationCache=e:i.latestMainCacheProtectedCache=e})))}var n,i,s,c,u,o,h;return a(e,[{key:"serializeLatestCacheData",value:(h=t(regeneratorRuntime.mark((function e(){var r=this;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",this.asyncQueue(t(regeneratorRuntime.mark((function e(){return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,r.cacheSerializer.storeSerializedData({windowCache:r.latestWindowCache,mainCacheProbationCache:r.latestMainCacheProbationCache,mainCacheProtectedCache:r.latestMainCacheProtectedCache,admissionPolicyCache:r.latestAdmissionPolicySerializedData});case 2:r.latestWindowCache=void 0,r.latestMainCacheProbationCache=void 0,r.latestMainCacheProtectedCache=void 0,r.latestAdmissionPolicySerializedData=void 0;case 6:case"end":return e.stop()}}),e)})))));case 1:case"end":return e.stop()}}),e,this)}))),function(){return h.apply(this,arguments)})},{key:"size",value:function(){return this.windowCache.size+this.mainCache.size+this.admissionPolicy.size()}},{key:"keepEfficiency",value:(o=t(regeneratorRuntime.mark((function e(){return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:this.admissionPolicy.keepEfficiency()&&this.updateLatestAdmissionPolicyCache();case 1:case"end":return e.stop()}}),e,this)}))),function(){return o.apply(this,arguments)})},{key:"contains",value:function(e){return!!this.windowCache.lookupMetadata(e)||!!this.mainCache.lookupMetadata(e)}},{key:"put",value:(u=t(regeneratorRuntime.mark((function e(r){var n,a,i,s,c=this;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=r.key,a=r.value,i=r.size,s=r.type,e.abrupt("return",this.asyncQueue(t(regeneratorRuntime.mark((function e(){var r,u;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,c.restoreAdmissionPolicy();case 2:if(!(r=c.windowCache.estimate(i)).isAcceptable){e.next=9;break}return e.next=6,r.entries.reduce(function(){var e=t(regeneratorRuntime.mark((function e(t,r){var n,a;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,t;case 2:if(!(n=c.mainCache.estimate(r.key,r.sizeHint)).isAcceptable){e.next=12;break}if(!c.admissionPolicy.judge(r,n.entries)){e.next=12;break}return e.next=7,c.windowCache.lookupCache(r.key);case 7:if(!(a=e.sent)){e.next=12;break}return e.next=11,c.mainCache.put({key:r.key,value:a,sizeHint:r.sizeHint,data:r.data});case 11:c.admissionPolicy.put(r.key);case 12:case"end":return e.stop()}}),e)})));return function(t,r){return e.apply(this,arguments)}}(),Promise.resolve());case 6:return e.next=8,c.windowCache.put({key:n,value:a,sizeHint:i,data:{t:s}});case 8:return e.abrupt("return",!0);case 9:if(!(u=c.mainCache.estimate(n,i)).isAcceptable){e.next=15;break}if(!c.admissionPolicy.judge(new I(n,i),u.entries)){e.next=14;break}return e.next=14,c.mainCache.put({key:n,value:a,sizeHint:i,data:{t:s}});case 14:return e.abrupt("return",!0);case 15:return e.abrupt("return",!1);case 16:case"end":return e.stop()}}),e)})))));case 2:case"end":return e.stop()}}),e,this)}))),function(e){return u.apply(this,arguments)})},{key:"get",value:(c=t(regeneratorRuntime.mark((function e(r){var n=this;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",this.asyncQueue(t(regeneratorRuntime.mark((function e(){var t;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,n.restoreAdmissionPolicy();case 2:if(!n.windowCache.lookupMetadata(r)){e.next=8;break}return e.next=5,n.windowCache.get(r);case 5:t=e.sent,e.next=11;break;case 8:return e.next=10,n.mainCache.get(r);case 10:t=e.sent;case 11:if(!t){e.next=15;break}return n.admissionPolicy.put(r),n.updateLatestAdmissionPolicyCache(),e.abrupt("return",t);case 15:case"end":return e.stop()}}),e)})))));case 1:case"end":return e.stop()}}),e,this)}))),function(e){return c.apply(this,arguments)})},{key:"delete",value:(s=t(regeneratorRuntime.mark((function e(r){var n=this;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",this.asyncQueue(t(regeneratorRuntime.mark((function e(){return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,n.restoreAdmissionPolicy();case 2:return e.next=4,n.windowCache.delete(r);case 4:return e.next=6,n.mainCache.delete(r);case 6:case"end":return e.stop()}}),e)})))));case 1:case"end":return e.stop()}}),e,this)}))),function(e){return s.apply(this,arguments)})},{key:"collectGarbage",value:(i=t(regeneratorRuntime.mark((function e(){var r,n;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.mainCacheEntityStorage.keys();case 2:return r=e.sent,e.next=5,this.windowCacheEntityStorage.keys();case 5:return n=e.sent,e.abrupt("return",Promise.all([{keys:r,storage:this.mainCacheEntityStorage,cache:this.mainCache},{keys:n,storage:this.windowCacheEntityStorage,cache:this.windowCache}].flatMap(function(){var e=t(regeneratorRuntime.mark((function e(r){var n,a,i;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=r.keys,a=r.storage,i=r.cache,e.abrupt("return",n.map(function(){var e=t(regeneratorRuntime.mark((function e(t){return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(i.lookupMetadata(t.url)){e.next=2;break}return e.abrupt("return",a.delete(t.url));case 2:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()));case 2:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}())));case 7:case"end":return e.stop()}}),e,this)}))),function(){return i.apply(this,arguments)})},{key:"collectMetrics",value:function(){var e=this,t=function(t){var r=t.cacheEntryMap,n=t.cacheMetricsMap;return Object.keys(r).reduce((function(t,n){var a=r[n];return t[n]={estimatedRank:e.admissionPolicy.frequency(a),estimatedSize:a.sizeHint,type:a.data&&a.data.t?H[a.data.t]:"unknown"},t}),n)},r=Object.create(null);t({cacheEntryMap:this.windowCache.toJSON().cacheMetadata,cacheMetricsMap:r});var n=this.mainCache.toJSON(),a=n.probationSegment,i=n.protectedSegment;return t({cacheEntryMap:a.cacheMetadata,cacheMetricsMap:r}),t({cacheEntryMap:i.cacheMetadata,cacheMetricsMap:r}),{entries:r,size:this.size()}}},{key:"restoreAdmissionPolicy",value:(n=t(regeneratorRuntime.mark((function e(){return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!Z){e.next=2;break}return e.abrupt("return");case 2:return Z=!0,e.abrupt("return",this.cacheSerializer.restoreAdmissionPolicy({admissionPolicy:this.admissionPolicy}));case 4:case"end":return e.stop()}}),e,this)}))),function(){return n.apply(this,arguments)})},{key:"updateLatestAdmissionPolicyCache",value:function(){this.latestAdmissionPolicySerializedData=this.admissionPolicy.serialize()}}]),e}(),K={"application/javascript":"js","text/javascript":"js","text/css":"css","application/css":"css","image/jpeg":"image","image/jpg":"image","image/png":"image","image/gif":"image","image/bmp":"image","image/webp":"image","image/svg+xml":"image","image/vnd.microsoft.icon":"image","font/woff":"font","font/ttf":"font","font/otf":"font","application/font-otf":"font","application/font-ttf":"font","application/font-woff":"font","application/font-sfnt":"font","text/html":"document"},V=function(e){var t=e.headers.get("content-type");return t&&K[t.split(";")[0].trim().toLowerCase()]||"unknown"},X=function(){var e=t(regeneratorRuntime.mark((function e(t){var r,n,a,s,c;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(n=t.admissionPolicyCache,a=t.serializedResponse,!n){e.next=3;break}return e.abrupt("return",{blob:new Blob([n.fs.table.buffer,n.dk.table.buffer]),headers:(s={},i(s,"x-repro-ec-blob-fs-index","".concat(n.fs.table.byteLength)),i(s,"x-repro-ec-blob-dk-metadata",n.dk.metadata.join(",")),i(s,"x-repro-ec-blob-fs-metadata",n.fs.metadata.join(",")),s)});case 3:if(!a){e.next=9;break}return e.next=6,a.clone().blob();case 6:return e.t0=e.sent,e.t1=(i(c={},"x-repro-ec-blob-fs-index",a.headers.get("x-repro-ec-blob-fs-index")),i(c,"x-repro-ec-blob-dk-metadata",a.headers.get("x-repro-ec-blob-dk-metadata")),i(c,"x-repro-ec-blob-fs-metadata",a.headers.get("x-repro-ec-blob-fs-metadata")),c),e.abrupt("return",{blob:e.t0,headers:e.t1});case 9:return e.abrupt("return",{blob:new Blob([]),headers:(r={},i(r,"x-repro-ec-blob-fs-index","-1"),i(r,"x-repro-ec-blob-dk-metadata",""),i(r,"x-repro-ec-blob-fs-metadata",""),r)});case 10:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),Y=function(e){var t=e.cache,r=e.serializedResponse,n=e.key;if(t)return i({},n,JSON.stringify(t));if(r){var a=r.headers.get(n);return a?i({},n,a):{}}return{}},$=function(){function e(t){r(this,e),this.fastCache=t}var n,i,s;return a(e,[{key:"storeSerializedData",value:(s=t(regeneratorRuntime.mark((function e(t){var r,n,a,i,s,c,o;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=t.windowCache,n=t.mainCacheProbationCache,a=t.mainCacheProtectedCache,i=t.admissionPolicyCache,e.next=3,this.fastCache.get(g);case 3:return s=e.sent,e.next=6,X({serializedResponse:s,admissionPolicyCache:i});case 6:return c=e.sent,o=new Response(c.blob,{status:200,headers:u({},c.headers,{},Y({cache:r,serializedResponse:s,key:"x-repro-ec-wc-metadata"}),{},Y({cache:n,serializedResponse:s,key:"x-repro-ec-mcpb-metadata"}),{},Y({cache:a,serializedResponse:s,key:"x-repro-ec-mcpt-metadata"}))}),e.next=10,this.fastCache.put(g,o);case 10:case"end":return e.stop()}}),e,this)}))),function(e){return s.apply(this,arguments)})},{key:"restoreAdmissionPolicy",value:(i=t(regeneratorRuntime.mark((function e(t){var r,n,a,i,s,c,u,o,h,p;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=t.admissionPolicy,e.next=3,this.fastCache.get(g);case 3:if(!(n=e.sent)){e.next=27;break}if(!((a=+n.headers.get("x-repro-ec-blob-fs-index"))<0)){e.next=8;break}return e.abrupt("return");case 8:return e.next=10,n.clone().blob();case 10:return i=e.sent,s=i.slice(0,a),c=i.slice(a,i.size),e.t0=Uint32Array,e.next=16,s.arrayBuffer();case 16:return e.t1=e.sent,u=new e.t0(e.t1),e.t2=Uint8Array,e.next=21,c.arrayBuffer();case 21:e.t3=e.sent,o=new e.t2(e.t3),h=n.headers.get("x-repro-ec-blob-fs-metadata").split(",").map((function(e){return+e})),p=n.headers.get("x-repro-ec-blob-dk-metadata").split(",").map((function(e){return+e})),r.restoreDoorkeeper({metadata:p,table:o}),r.restoreFrequencySketch({metadata:h,table:u});case 27:case"end":return e.stop()}}),e,this)}))),function(e){return i.apply(this,arguments)})},{key:"restoreLruCache",value:(n=t(regeneratorRuntime.mark((function e(t){var r,n,a,i;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=t.lruCache,n=t.isMainCache,e.next=3,this.fastCache.get(g);case 3:(a=e.sent)&&(i="",(i=n?a.headers.get("probation"===r.name?"x-repro-ec-mcpb-metadata":"x-repro-ec-mcpt-metadata")||"":a.headers.get("x-repro-ec-wc-metadata")||"")&&r.restore(JSON.parse(i)));case 5:case"end":return e.stop()}}),e,this)}))),function(e){return n.apply(this,arguments)})}]),e}(),ee=function(){function e(t,n){r(this,e),this.index=t,this.configPromise=n,this.cache=new W(5e6,this.index,new $(function(e){return new b(caches.open("".concat("rpr-precacher","-cache-serialization-").concat(e)))}(this.index)))}var n,i,s,c;return a(e,[{key:"set",value:(c=t(regeneratorRuntime.mark((function e(t,r){var n,a,i;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=r.headers.get("content-length"),a=r.headers.get("x-repro-cache-type"),i=P[a]||P[V(r)]||P.unknown,e.abrupt("return",this.cache.put({key:t.url,value:r,size:n?+n:1,type:i}));case 4:case"end":return e.stop()}}),e,this)}))),function(e,t){return c.apply(this,arguments)})},{key:"get",value:(s=t(regeneratorRuntime.mark((function e(t){var r,n,a,i;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.cache.get(t.url);case 2:if(!(r=e.sent)){e.next=14;break}return n=r.headers.get("x-repro-cache-type")||"unknown",a=r.headers.get("x-repro-cache-timestamp")||"0",e.next=8,this.configPromise;case 8:if(!((i=e.sent).cacheConfig[n]&&Date.now()-+a<i.cacheConfig[n])){e.next=11;break}return e.abrupt("return",{value:[t.clone(),r.clone()]});case 11:return this.cache.keepEfficiency(),e.next=14,this.cache.delete(t.url);case 14:return e.abrupt("return",void 0);case 15:case"end":return e.stop()}}),e,this)}))),function(e){return s.apply(this,arguments)})},{key:"collectMetrics",value:function(){return u({},this.cache.collectMetrics(),{nodeIndex:this.index})}},{key:"collectGarbage",value:(i=t(regeneratorRuntime.mark((function e(){return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",this.cache.collectGarbage());case 1:case"end":return e.stop()}}),e,this)}))),function(){return i.apply(this,arguments)})},{key:"contains",value:function(e){return this.cache.contains(e)}},{key:"serializeLatestCacheData",value:(n=t(regeneratorRuntime.mark((function e(){return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",this.cache.serializeLatestCacheData());case 1:case"end":return e.stop()}}),e,this)}))),function(){return n.apply(this,arguments)})},{key:"size",value:function(){return this.cache.size()}}]),e}(),te=!0,re=function(){function e(){r(this,e),this.configPromise=S(),this.cacheNodeSizeBasedPriorityQueue=new C((function(e,t){return t.priority-e.priority})),this.cacheNodeList=[],this.asyncQueue=L();for(var t=Math.ceil(e.SIZE_LIMIT/5e6)||1,n=0;n<t;n++)this.grow(n)}var n,i,s,c,u,o,h;return a(e,[{key:"storeSerializedCache",value:(h=t(regeneratorRuntime.mark((function e(){var r=this;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",this.asyncQueue(t(regeneratorRuntime.mark((function e(){return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",Promise.all(r.cacheNodeList.map(function(){var e=t(regeneratorRuntime.mark((function e(t){return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",t.serializeLatestCacheData());case 1:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}())));case 1:case"end":return e.stop()}}),e)})))));case 1:case"end":return e.stop()}}),e,this)}))),function(){return h.apply(this,arguments)})},{key:"set",value:(o=t(regeneratorRuntime.mark((function e(r,n){var a=this;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",this.asyncQueue(t(regeneratorRuntime.mark((function e(){var t,i;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!(t=a.cacheNodeSizeBasedPriorityQueue.pop())){e.next=7;break}return e.next=4,t.set(r,n);case 4:return i=e.sent,a.cacheNodeSizeBasedPriorityQueue.push({value:t,priority:t.size()}),e.abrupt("return",i);case 7:return e.abrupt("return",!1);case 8:case"end":return e.stop()}}),e)})))));case 1:case"end":return e.stop()}}),e,this)}))),function(e,t){return o.apply(this,arguments)})},{key:"get",value:(u=t(regeneratorRuntime.mark((function e(t){var r,n,a;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:r=-1,n=0;case 2:if(!(n<this.cacheNodeList.length)){e.next=9;break}if(!this.cacheNodeList[n].contains(t.url)){e.next=6;break}return r=n,e.abrupt("break",9);case 6:n++,e.next=2;break;case 9:if(-1!==r){e.next=11;break}return e.abrupt("return");case 11:if(!this.cacheNodeList[r]){e.next=17;break}return e.next=14,this.cacheNodeList[r].get(t);case 14:if(!(a=e.sent)){e.next=17;break}return e.abrupt("return",a.value);case 17:case"end":return e.stop()}}),e,this)}))),function(e){return u.apply(this,arguments)})},{key:"collectGarbage",value:(c=t(regeneratorRuntime.mark((function e(){var t,r;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,x.get(m);case 2:if(t=e.sent,r=0,!t){e.next=9;break}return e.next=7,t.json();case 7:(r=e.sent)===this.cacheNodeList.length&&(r=0);case 9:return e.next=11,this.cacheNodeList[r].collectGarbage();case 11:return e.next=13,x.put(m,new Response("".concat(r+1)));case 13:case"end":return e.stop()}}),e,this)}))),function(){return c.apply(this,arguments)})},{key:"checkObjectState",value:(s=t(regeneratorRuntime.mark((function t(){var r;return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(!te){t.next=6;break}return te=!1,t.next=4,S();case 4:r=t.sent,e.SIZE_LIMIT=r.cacheLimit;case 6:case"end":return t.stop()}}),t)}))),function(){return s.apply(this,arguments)})},{key:"collectMetrics",value:(i=t(regeneratorRuntime.mark((function e(){return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,navigator.storage.estimate();case 2:return e.t0=e.sent,e.t1=this.cacheNodeList.map((function(e){return e.collectMetrics()})),e.abrupt("return",{estimatedCacheStorageUsage:e.t0,cacheMetrics:e.t1});case 5:case"end":return e.stop()}}),e,this)}))),function(){return i.apply(this,arguments)})},{key:"grow",value:(n=t(regeneratorRuntime.mark((function e(t){var r;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:r=new ee(t,this.configPromise),this.cacheNodeList.push(r),this.cacheNodeSizeBasedPriorityQueue.push({value:r,priority:r.size()});case 3:case"end":return e.stop()}}),e,this)}))),function(e){return n.apply(this,arguments)})}],[{key:"getInstance",value:function(){return O||(O=new e),O}}]),e}();re.SIZE_LIMIT=f.cacheLimit;var ne,ae,ie=function(e){clearTimeout(_),_=setTimeout((function(){e.storeSerializedCache()}),500)},se=function(){var e=t(regeneratorRuntime.mark((function e(t){var r,n,a;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=t.shardedCache,n=t.request,a=t.response,e.next=3,r.set(n,a);case 3:if(e.sent){e.next=8;break}return e.next=6,w.put(n.url,k);case 6:e.next=9;break;case 8:ie(r);case 9:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),ce=function(){var e=t(regeneratorRuntime.mark((function e(t){var r,n,a,i,s,c,u,o,h;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=t.parsedUrl,n=t.shardedCache,a=t.response,i=t.request,s=t.type,c=t.wait,u=s||V(a),e.next=4,z(a,(function(e){return e.append("x-repro-cache-timestamp","".concat(Date.now())),e.append("x-repro-cache-type","".concat(u)),e}));case 4:if((o=e.sent).ok){e.next=7;break}return e.abrupt("return",o);case 7:if(e.t0="unknown"!==s,!e.t0){e.next=12;break}return e.next=11,w.get(r.href);case 11:e.t0=!e.sent;case 12:if(!e.t0){e.next=15;break}h=o.clone(),c(se({shardedCache:n,request:i,response:h}));case 15:return e.abrupt("return",o);case 16:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),ue=function(){var e=t(regeneratorRuntime.mark((function e(t){var r,n,a,i,s,c,u,o;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=t.parsedUrl,n=t.wait,a=t.type,r.hash="",i=new Request(r.href,{method:"get"}),s=re.getInstance(),e.next=6,s.checkObjectState();case 6:return e.next=8,s.get(i);case 8:if(!(c=e.sent)){e.next=12;break}return ie(s),e.abrupt("return",c[1]);case 12:return e.next=14,s.get(i);case 14:if(!(u=e.sent)){e.next=18;break}return ie(s),e.abrupt("return",u[1]);case 18:if(!ne||ne.url.href!==r.href){e.next=20;break}return e.abrupt("return",ne.response.then((function(e){return e.clone()})));case 20:return o=fetch(i).then((function(e){return ce({parsedUrl:r,response:e,shardedCache:s,request:i,type:a,wait:n})})),"document"===a&&(ne={url:r,response:o}),e.abrupt("return",o);case 23:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),oe=function(){var e=t(regeneratorRuntime.mark((function e(r){var n,a,i,s,c,u,o,h;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:n=r.data,a=r.ports,i=r.wait,e.t0=n.type,e.next="repro-precacher-init"===e.t0?4:"repro-precacher-fetch"===e.t0?10:"repro-precacher-measurement"===e.t0?12:"repro-precacher-collect-metrics"===e.t0?15:"repro-precacher-collect-garbage"===e.t0?25:32;break;case 4:return s=n.config,re.SIZE_LIMIT=s.cacheLimit,e.next=8,x.put(d,new Response(JSON.stringify(s),{status:200}));case 8:return a[0].postMessage({}),e.abrupt("break",32);case 10:return c=n.urlList,e.abrupt("return",Promise.all(c.map(function(){var e=t(regeneratorRuntime.mark((function e(t){var r,n,a;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=t.url,n=t.type,a=new URL(r),e.next=4,w.get(r);case 4:if(e.t0=e.sent,e.t0){e.next=7;break}e.t0=a.origin!==origin;case 7:if(!e.t0){e.next=9;break}return e.abrupt("return");case 9:return e.abrupt("return",ue({parsedUrl:new URL(r),wait:i,type:n}));case 10:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}())).then((function(){a[0].postMessage({})})));case 12:return u=n.ts,i(R.get(y).then((function(e){return e?e.json():0})).then((function(e){e&&a[0].postMessage({elapsedTime:u-e})}))),e.abrupt("break",32);case 15:return o=re.getInstance(),e.next=18,o.checkObjectState();case 18:return e.t1=a[0],e.next=21,o.collectMetrics();case 21:return e.t2=e.sent,e.t3={metrics:e.t2},e.t1.postMessage.call(e.t1,e.t3),e.abrupt("break",32);case 25:return h=re.getInstance(),e.next=28,h.checkObjectState();case 28:return e.next=30,h.collectGarbage();case 30:return a[0].postMessage({}),e.abrupt("break",32);case 32:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),he=function(){var e=t(regeneratorRuntime.mark((function e(t){var r,n,a,i,s,c,u;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(r=t.request,n=t.origin,a=t.wait,i=r.url,s=new URL(i),n===s.origin&&"get"===r.method.toLowerCase()){e.next=5;break}return e.abrupt("return",fetch(r));case 5:return c=Date.now(),u=ue({parsedUrl:s,wait:a}),"navigate"===r.mode&&a(R.put(y,new Response(JSON.stringify(c),{status:200}))),e.abrupt("return",u);case 9:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}();function pe(e){null!=e.internalEventGid&&caches.open("repro_cache_v1").then((function(t){var r,n=Date.now();r="show"===e.action?"".concat("/repro/cache","?action=show&internal_event_gid=").concat(e.internalEventGid,"&tracked_at=").concat(n):"".concat("/repro/cache","?action=click&internal_event_gid=").concat(e.internalEventGid,"?click_action=").concat(e.action,"&tracked_at=").concat(n),t.put(r,new Response(r))}))}!function(e){e.CLICK="click",e.CLICK_BUTTON_1="click_button_1",e.CLICK_BUTTON_2="click_button_2"}(ae||(ae={})),self.addEventListener("push",(function(e){if(null!=e.data){var t=e.data.json();pe({action:"show",internalEventGid:t.options.data.internal_event_gid}),e.waitUntil(self.registration.showNotification(t.title,u({},t.options)))}})),self.addEventListener("install",(function(e){e.waitUntil(self.skipWaiting())})),self.addEventListener("activate",(function(e){e.waitUntil(self.clients.claim())})),self.addEventListener("notificationclick",(function(e){e.notification.close();var t=e.notification.data,r=ae.CLICK,n=null;switch(e.action){case"":n=t.notification_click_url||null;break;case e.notification.actions[0].action:r=ae.CLICK_BUTTON_1,n=t.action_click_1_url||null;break;case e.notification.actions[1].action:r=ae.CLICK_BUTTON_2,n=t.action_click_2_url||null}if(pe({action:r,internalEventGid:t.internal_event_gid}),null!=n){var a=self.clients.matchAll({type:"window",includeUncontrolled:!0}).then((function(e){for(var t=0;t<e.length;t+=1){var r=e[t];if(r.url===n)return r.focus()}return self.clients.openWindow(n)}));e.waitUntil(a)}})),self.addEventListener("message",(function(e){e.data&&e.waitUntil(oe({data:e.data,ports:e.ports,wait:function(t){e.waitUntil(t)}}))})),self.addEventListener("fetch",(function(e){e.respondWith(he({request:e.request,origin:self.origin,wait:function(t){e.waitUntil(t)}}))}))}();
